name: Generate Video
description: Invokes the video_generator Cloud Function.

inputs:
- {name: project, type: String, description: 'GCP Project ID'}
- {name: location, type: String, description: 'GCP Location for the function'}
- {name: veo_api_secret_id, type: String, description: 'The ID of the secret in Secret Manager'}
- {name: gcs_video_prompt_uri, type: String, description: 'GCS path to the final video prompt JSON'}
- {name: gcs_output_uri, type: String, description: 'GCS path to write the final video file'}

outputs:
- {name: gcs_output_path, type: String, description: 'The GCS path of the generated video file'}

implementation:
  container:
    image: google/cloud-sdk:slim
    command:
    - sh
    - -c
    - |
      set -e -x
      gcloud functions call generate_video \
        --region=$0 \
        --data='{"project": "'"$1"'", "location": "'"$2"'", "veo_api_secret_id": "'"$3"'", "gcs_video_prompt_uri": "'"$4"'", "gcs_output_uri": "'"$5"'"}'
      echo $5 > $6
    args:
    - {inputValue: location}
    - {inputValue: project}
    - {inputValue: location}
    - {inputValue: veo_api_secret_id}
    - {inputValue: gcs_video_prompt_uri}
    - {inputValue: gcs_output_uri}
    - {outputPath: gcs_output_path}